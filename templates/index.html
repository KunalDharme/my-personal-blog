<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Watson's Blog</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono&display=swap" rel="stylesheet">
</head>
<body>

<!-- Header Section -->
<header class="site-header">
  <div class="header-text">
    <h1>
      <span style="font-size: 30px; font-weight: normal; position: relative; top: -20px;">The Blog of</span>
      <span style="margin-left: 20px; font-size: 48px; font-weight: bold; font-family: Impact, cursive; color: #e6005c; text-shadow: 2px 2px 5px black;">
        Mr. Kunal V. Dharme
      </span>
    </h1>
    <p style="margin-top: 13px; font-family: 'Brush Script MT', cursive; font-size: 22px; color: #ffffff;">
      From the Science of Digital Deduction
    </p>
  </div>
  <div class="logo-container">
    <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo">
  </div>
</header>

<!-- Navigation Menu -->
<nav class="main-nav">
  <ul>
    <li><a href="index.html">Home</a></li>
    <li><a href="blog.html">Blogs</a></li>
    <li><a href="photos.html">Photos</a></li>
    <li><a href="contact.html">Contact</a></li>
    <li><a href="help.html">Help?</a></li>
  </ul>
</nav>

<!-- Main Content Area -->
<div class="container">
  
  <!-- Sidebar Section -->
  <aside class="sidebar">
    <div>
    <img src="{{ url_for('static', filename='images/kunal.jpg') }}" class="profile-img" alt="Kunal V. Dharme">
    <h2>I'm Kunal V. Dharme,</h2>
    <p>The world's only consulting investigator.<br>
      Contact me at: <strong>kunaldharme13@gmail.com</strong>
    </p>

    <!-- My Photos Title -->
    <h3 style="margin-top: 25px; margin-bottom: 10px; text-align: center; color: #0037ff;  margin-top: 50px;">‚îÅ‚îÅ‚îÅ My Photos ‚îÅ‚îÅ‚îÅ</h3>

    <!-- Photo Collage Preview -->
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px;">
      {% for photo in photo_list[:4] %}
        <img src="{{ url_for('static', filename='uploads/' ~ photo) }}" alt="Photo" style="width: 100%; height: 80px; object-fit: cover; border-radius: 6px;">
      {% endfor %}
    </div>

    <!-- View More Link -->
    <div style="text-align: center; margin-top: 8px;">
      <a href="{{ url_for('photos') }}" style="font-size: 0.9rem; color: #5d3100; text-decoration: none; font-weight: bold;">
        View More ‚Üí
      </a>
    </div>

    <!-- Famous Blogs Title -->
    <h3 style="margin-top: 30px; margin-bottom: 10px; text-align: center; color: #ff6f00;">‚îÅ‚îÅ‚îÅ Famous Blogs ‚îÅ‚îÅ‚îÅ</h3>

    <!-- Famous Blog Links -->
    <ul style="list-style-type: none; padding-left: 0;">
      {% for blog in famous_blogs %}
        <li style="margin-bottom: 8px;">
          <a href="{{ url_for('post', slug=blog.slug) }}" style="text-decoration: none; color: #003b99; font-weight: bold;">
            {{ blog.title }}
          </a>
        </li>
      {% else %}
        <li style="text-align: center; color: #888;">No famous blogs yet.</li>
      {% endfor %}
    </ul>

  </aside>

  <!-- Blog Post Section -->
  <main class="blog-posts">
    {% for blog in blogs[:3] %}
    <article>
      <!-- Blog Title + Like Button -->
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2><a href="{{ url_for('post', slug=blog.slug) }}">{{ blog.title }}</a></h2>
        <div>
          <button class="like-btn" onclick="toggleLike(this)" data-slug="{{ blog.slug }}">‚ù§Ô∏è</button>
          <span class="like-count" id="like-count-{{ blog.slug }}">0</span>
        </div>
      </div>

      <!-- Date and Preview -->
      <p class="date">{{ blog.created_at.strftime('%B %d, %Y') }}</p>
      <p>{{ blog.content[:150] }}{% if blog.content|length > 150 %}...{% endif %}</p>

      <!-- Approved Comments -->
      <div class="comments-section">
        <h4>Comments:</h4>
        {% for comment in blog.comments if comment.approved %}
          <p><strong>{{ comment.name }}</strong>: {{ comment.text }}</p>
        {% else %}
          <p>No comments yet.</p>
        {% endfor %}
      </div>

      <!-- Comment Form Toggle -->
      <button onclick="toggleCommentForm('comment-form-{{ blog.id }}')" class="toggle-comment-btn">üí¨ Add Comment</button>

      <!-- Hidden Comment Form -->
      <form id="comment-form-{{ blog.id }}" action="{{ url_for('post', slug=blog.slug) }}" method="post" class="comment-form" style="display: none;">
        <input type="text" name="name" placeholder="Your name" required>
        <textarea name="text" placeholder="Write your comment..." required></textarea>
        <button type="submit">Post Comment</button>
      </form>
    </article>
    {% else %}
    <p>No blog posts yet.</p>
    {% endfor %}

    <div style="text-align: center; margin-top: 8px;">
      <a href="{{ url_for('all_blogs') }}" style="font-size: 1rem; color: #00550d; text-decoration: none; font-weight: bold;">
      Click Here To Read More ‚Üí
      </a>
    </div>
  </main>

</div>

  <!-- Footer -->
  {% include 'footer.html' %}

<!-- Scripts: Like and Comment Toggle -->
<script>
  function toggleCommentForm(formId) {
    const form = document.getElementById(formId);
    form.style.display = form.style.display === "none" ? "block" : "none";
  }

  function toggleLike(button) {
    const slug = button.getAttribute('data-slug');
    const countSpan = document.getElementById('like-count-' + slug);
    const storageKey = 'likes-' + slug;

    let liked = localStorage.getItem(storageKey) === 'true';
    liked = !liked;
    localStorage.setItem(storageKey, liked);

    let currentCount = parseInt(localStorage.getItem(storageKey + '-count')) || 0;
    currentCount = liked ? currentCount + 1 : Math.max(currentCount - 1, 0);

    localStorage.setItem(storageKey + '-count', currentCount);
    countSpan.textContent = currentCount;
    button.textContent = liked ? '‚ù§Ô∏è' : 'ü§ç';
    button.classList.toggle('liked', liked);
  }

  window.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.like-btn').forEach(button => {
      const slug = button.getAttribute('data-slug');
      const liked = localStorage.getItem('likes-' + slug) === 'true';
      const count = parseInt(localStorage.getItem('likes-' + slug + '-count')) || 0;

      button.textContent = liked ? '‚ù§Ô∏è' : 'ü§ç';
      button.classList.toggle('liked', liked);
      document.getElementById('like-count-' + slug).textContent = count;
    });
  });
</script>

</body>
</html>
